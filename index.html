<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mahjong Solitaire Modern - Ubin Besar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');

        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle, #1a472a 0%, #0d2b1a 100%);
            height: 100vh;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            color: white;
        }

        #game-container {
            position: relative;
            flex-grow: 1;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 2000px; /* Perspektif lebih jauh untuk ubin besar */
        }

        #board {
            position: relative;
            width: 1200px; /* Diperlebar untuk ubin besar */
            height: 850px;
            transform-style: preserve-3d;
        }

        .tile {
            position: absolute;
            width: 80px;  /* Jauh lebih besar */
            height: 110px; /* Jauh lebih besar */
            background: #fdfdfd;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 64px; /* Simbol sangat besar */
            user-select: none;
            transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                3px 3px 0px #ccc,
                6px 6px 10px rgba(0,0,0,0.5);
            border: 1px solid #bbb;
            z-index: var(--z);
        }

        .tile::before {
            content: '';
            position: absolute;
            left: -8px;
            top: 8px;
            width: 8px;
            height: 100%;
            background: #d4d4d4;
            transform: skewY(-45deg);
            border-radius: 4px 0 0 4px;
        }

        .tile::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 4px;
            width: 100%;
            height: 8px;
            background: #b8b8b8;
            transform: skewX(-45deg);
            border-radius: 0 0 4px 4px;
        }

        .tile.selected {
            background: #ffeb3b;
            transform: translateY(-15px) translateZ(40px) !important;
            box-shadow: 0 25px 50px rgba(0,0,0,0.7);
            border-color: #fbc02d;
        }

        .tile.hint {
            animation: pulse 0.8s infinite alternate;
            border-color: #3b82f6;
            background: #e0f2fe;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            100% { box-shadow: 0 0 0 20px rgba(59, 130, 246, 0); }
        }

        .stats-panel {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(15px);
            border-bottom: 2px solid rgba(255,255,255,0.05);
        }

        .btn-action {
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 700;
        }

        .btn-action:hover {
            filter: brightness(1.2);
            transform: translateY(-2px);
        }

        /* Skala Otomatis agar papan muat di layar */
        @media (max-width: 1300px) {
            #board { transform: scale(0.85); }
        }
        @media (max-width: 1100px) {
            #board { transform: scale(0.7); }
        }
        @media (max-width: 900px) {
            #board { transform: scale(0.55); }
        }
        @media (max-width: 700px) {
            #board { transform: scale(0.4); }
        }
    </style>
</head>
<body>

    <!-- Panel Statistik Atas -->
    <div class="stats-panel p-5 flex justify-between items-center z-50 shadow-2xl">
        <div class="flex gap-12">
            <div class="text-center">
                <span class="text-blue-400 text-xs font-bold uppercase tracking-widest block mb-1">Skor</span>
                <span id="score" class="text-3xl font-extrabold tracking-tighter">0</span>
            </div>
            <div class="text-center">
                <span class="text-blue-400 text-xs font-bold uppercase tracking-widest block mb-1">Waktu</span>
                <span id="timer" class="text-3xl font-extrabold tracking-tighter">00:00</span>
            </div>
            <div class="text-center">
                <span class="text-blue-400 text-xs font-bold uppercase tracking-widest block mb-1">Sisa Ubin</span>
                <span id="remaining" class="text-3xl font-extrabold tracking-tighter">0</span>
            </div>
        </div>
        <div class="flex gap-4">
            <button onclick="hintMove()" class="btn-action px-6 py-3 bg-blue-600 rounded-xl shadow-lg">Bantuan</button>
            <button onclick="initGame()" class="btn-action px-6 py-3 bg-red-600 rounded-xl shadow-lg">Mulai Ulang</button>
        </div>
    </div>

    <div id="game-container">
        <div id="board"></div>
    </div>

    <!-- Modal Menang -->
    <div id="win-modal" class="fixed inset-0 bg-black/90 hidden flex flex-col justify-center items-center z-[100]">
        <div class="bg-white/10 p-12 rounded-3xl border border-white/20 text-center backdrop-blur-xl">
            <h1 class="text-7xl font-black mb-4 text-yellow-400 drop-shadow-lg">MENANG!</h1>
            <p class="text-2xl mb-10 text-gray-300">Anda telah menyelesaikan tantangan ini.</p>
            <button onclick="initGame()" class="px-12 py-5 bg-green-500 hover:bg-green-400 rounded-2xl font-black text-2xl transition-all shadow-2xl hover:scale-105 active:scale-95">MAIN LAGI</button>
        </div>
    </div>

    <script>
        // Ukuran konstanta yang jauh lebih besar
        const TILE_WIDTH = 80;
        const TILE_HEIGHT = 110;

        const TILE_TYPES = [
            'ğŸ€€', 'ğŸ€', 'ğŸ€‚', 'ğŸ€ƒ', 'ğŸ€„', 'ğŸ€…', 'ğŸ€†',
            'ğŸ€‡', 'ğŸ€ˆ', 'ğŸ€‰', 'ğŸ€Š', 'ğŸ€‹', 'ğŸ€Œ', 'ğŸ€', 'ğŸ€', 'ğŸ€',
            'ğŸ€', 'ğŸ€‘', 'ğŸ€’', 'ğŸ€“', 'ğŸ€”', 'ğŸ€•', 'ğŸ€–', 'ğŸ€—', 'ğŸ€˜',
            'ğŸ€™', 'ğŸ€š', 'ğŸ€›', 'ğŸ€œ', 'ğŸ€', 'ğŸ€', 'ğŸ€Ÿ', 'ğŸ€ ', 'ğŸ€¡',
            'ğŸ€¢', 'ğŸ€£', 'ğŸ€¤', 'ğŸ€¥', 'ğŸ€¦', 'ğŸ€§', 'ğŸ€¨', 'ğŸ€©'
        ];

        let tiles = [];
        let selectedTile = null;
        let score = 0;
        let seconds = 0;
        let timerInterval;

        function generateLayout() {
            const layout = [];
            
            // Layer 0 (Dasar 12x8)
            for (let r = 0; r < 8; r++) {
                for (let c = 0; c < 12; c++) {
                    if ((r === 0 || r === 7) && (c < 2 || c > 9)) continue;
                    layout.push({x: c, y: r, z: 0});
                }
            }

            // Layer 1
            for (let r = 1; r < 7; r++) {
                for (let c = 3; c < 9; c++) {
                    layout.push({x: c + 0.5, y: r + 0.5, z: 1});
                }
            }

            // Layer 2
            for (let r = 2; r < 6; r++) {
                for (let c = 4; c < 8; c++) {
                    layout.push({x: c + 1, y: r + 1, z: 2});
                }
            }

            // Layer 3
            for (let r = 3; r < 5; r++) {
                for (let c = 5; c < 7; c++) {
                    layout.push({x: c + 1.5, y: r + 1.5, z: 3});
                }
            }

            // Ubin Paling Atas (Mahkota)
            layout.push({x: 6.5, y: 4, z: 4});

            if (layout.length % 2 !== 0) layout.pop();
            return layout;
        }

        function initGame() {
            const board = document.getElementById('board');
            board.innerHTML = '';
            document.getElementById('win-modal').classList.add('hidden');
            
            score = 0;
            seconds = 0;
            updateScore();
            resetTimer();
            
            const layout = generateLayout();
            const totalTiles = layout.length;
            
            let faces = [];
            while (faces.length < totalTiles) {
                let type = TILE_TYPES[Math.floor(Math.random() * TILE_TYPES.length)];
                faces.push(type, type);
            }
            faces.sort(() => Math.random() - 0.5);

            tiles = layout.map((pos, i) => {
                return {
                    id: i,
                    x: pos.x,
                    y: pos.y,
                    z: pos.z,
                    face: faces[i],
                    matched: false
                };
            });

            renderBoard();
            startTimer();
            updateRemaining();
        }

        function renderBoard() {
            const board = document.getElementById('board');
            board.innerHTML = '';

            // Render ubin secara berurutan berdasarkan Z untuk tumpukan yang benar
            tiles.sort((a, b) => a.z - b.z || a.y - b.y || a.x - b.x).forEach(tile => {
                if (tile.matched) return;

                const el = document.createElement('div');
                el.className = 'tile';
                el.innerHTML = tile.face;
                
                // Kalkulasi posisi dengan spasi yang disesuaikan untuk ubin besar
                const leftPos = tile.x * (TILE_WIDTH + 8);
                const topPos = tile.y * (TILE_HEIGHT - 20); // Merapatkan tumpukan vertikal
                
                el.style.left = `${leftPos}px`;
                el.style.top = `${topPos}px`;
                el.style.setProperty('--z', tile.z * 100 + tile.y);
                
                // Efek 3D lebih berani
                el.style.transform = `translateZ(${tile.z * 12}px) translateX(${tile.z * -4}px) translateY(${tile.z * -4}px)`;

                el.onclick = () => handleTileClick(tile, el);
                board.appendChild(el);
                tile.el = el;
            });
        }

        function isSelectable(tile) {
            // Cek ubin di atasnya
            const onTop = tiles.some(t => 
                !t.matched && 
                t.z > tile.z && 
                Math.abs(t.x - tile.x) < 1 && 
                Math.abs(t.y - tile.y) < 1
            );
            if (onTop) return false;

            // Cek tetangga kiri/kanan
            const blockedLeft = tiles.some(t => 
                !t.matched && t.z === tile.z && t.x === tile.x - 1 && Math.abs(t.y - tile.y) < 1
            );

            const blockedRight = tiles.some(t => 
                !t.matched && t.z === tile.z && t.x === tile.x + 1 && Math.abs(t.y - tile.y) < 1
            );

            return !blockedLeft || !blockedRight;
        }

        function handleTileClick(tile, el) {
            if (!isSelectable(tile)) return;

            if (selectedTile) {
                if (selectedTile.id === tile.id) {
                    el.classList.remove('selected');
                    selectedTile = null;
                } else if (selectedTile.face === tile.face) {
                    tile.matched = true;
                    selectedTile.matched = true;
                    
                    const prevEl = selectedTile.el;
                    el.style.opacity = '0';
                    el.style.transform += ' scale(1.5) rotate(15deg)';
                    prevEl.style.opacity = '0';
                    prevEl.style.transform += ' scale(1.5) rotate(-15deg)';

                    setTimeout(() => {
                        renderBoard();
                        checkWin();
                    }, 300);

                    score += 150;
                    updateScore();
                    updateRemaining();
                    selectedTile = null;
                } else {
                    document.querySelectorAll('.tile').forEach(t => t.classList.remove('selected'));
                    el.classList.add('selected');
                    selectedTile = tile;
                }
            } else {
                el.classList.add('selected');
                selectedTile = tile;
            }
        }

        function updateScore() {
            document.getElementById('score').innerText = score;
        }

        function updateRemaining() {
            const count = tiles.filter(t => !t.matched).length;
            document.getElementById('remaining').innerText = count;
        }

        function startTimer() {
            resetTimer();
            timerInterval = setInterval(() => {
                seconds++;
                const mins = Math.floor(seconds / 60).toString().padStart(2, '0');
                const secs = (seconds % 60).toString().padStart(2, '0');
                document.getElementById('timer').innerText = `${mins}:${secs}`;
            }, 1000);
        }

        function resetTimer() {
            clearInterval(timerInterval);
            document.getElementById('timer').innerText = "00:00";
        }

        function checkWin() {
            const remaining = tiles.filter(t => !t.matched).length;
            if (remaining === 0) {
                clearInterval(timerInterval);
                document.getElementById('win-modal').classList.remove('hidden');
            }
        }

        function hintMove() {
            const selectable = tiles.filter(t => !t.matched && isSelectable(t));
            
            for (let i = 0; i < selectable.length; i++) {
                for (let j = i + 1; j < selectable.length; j++) {
                    if (selectable[i].face === selectable[j].face) {
                        selectable[i].el.classList.add('hint');
                        selectable[j].el.classList.add('hint');
                        
                        setTimeout(() => {
                            if(selectable[i].el) selectable[i].el.classList.remove('hint');
                            if(selectable[j].el) selectable[j].el.classList.remove('hint');
                        }, 1500);
                        return;
                    }
                }
            }
            // Pesan bantuan jika buntu
            const el = document.createElement('div');
            el.className = "fixed top-20 left-1/2 -translate-x-1/2 bg-red-600 px-6 py-3 rounded-full font-bold shadow-2xl z-[100] animate-bounce";
            el.innerText = "Tidak ada gerakan tersisa! Tekan Mulai Ulang.";
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 3000);
        }

        window.onload = initGame;
    </script>
</body>
</html>
